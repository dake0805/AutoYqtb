<!DOCTYPE html>

<script src="../static/js/jquery.min.js"></script>
<script src="../static/js/eams.area.data.js"></script>
<script src="../static/js/eams.area.js"></script>
<link rel="stylesheet" href="../static/css/style.css">

<html lang="zh">

<head>
    <meta charset="UTF-8">
    <title>自动填报系统</title>
</head>
<body>
<div class="header">
    <h2>疫情自动填报</h2>
</div>
<div class="menu">
    <a href="/login">修改已登记的信息</a><br><br><br>
</div>

<div class="register-form">
    <form method="post">

        <div class="input-box">
            account:<input type="text" id="account" required="required"><br>
            password:<input type="password" id="password" required="required"><br><br>
        </div>

        <div id="location-choose">
            <label class="location-choose-radio" for="inSchool">
                在学校
                <input type="radio" name="szcsbm" id="inSchool">
                <span class="checkmark"></span>
            </label>

            <label class="location-choose-radio" for="inXian">
                在西安（租住校内房屋或住在校外的学生）
                <input type="radio" name="szcsbm" id="inXian" value="2" onclick="changeWz(2)">
                <span class="checkmark"></span>
            </label>

            <label>
                在国内（西安市以外的其他国内地区）
                <div class="weui-cell__ft">
                    <input type="radio" name="szcsbm" value="3" onclick="changeWz(3)" id="x13">
                </div>
            </label>

            <div id="qtwz" style="display: none;margin-top: 0;">

                <select id="province" onchange="changeSelect(this);">
                    <option value="">-省-</option>
                </select>

                <select id="city" onchange="changeSelect(this);">
                    <option value="">-市-</option>
                </select>

                <select name="hjbm" id="district">
                    <option value="">-区/县-</option>
                </select>
            </div>
            <input type="button" onclick="mySubmit()" value="submit">
            <br>
        </div>

    </form>
</div>

<footer>
    <div class="contact">
        <h3>CONTACT ME</h3>
        <div class="info-box">
            <a href="https://github.com/dake0805/AutoYqtb">
                <img src="http://placehold.it/40x40" alt="">
                GitHub
            </a>
        </div>
        <div class="info-box">
            <a href="mailto:dake0805@qq.com">
                <img src="http://placehold.it/40x40" alt="">
                Mail
            </a>
        </div>
    </div>
    <div class="copyright">
        <br>免责声明<br>
    </div>
</footer>

</body>
</html>

<script>
    initSeletList();
</script>

<script>
    function changeWz(num) {
        if (num == '3' || num == '4') {
            $("#qtwz").show();
            $("input[name='sfmtbg'][value='0']").attr('checked', 'true');
            if (num == '3') {
                $("#province").show();
                $("#city").show();
                $("#district").show();
                $("#gwcs").hide();
                $("#gwcs").val("");
            } else {
                $("#province").hide();
                $("#city").hide();
                $("#district").hide();
                $("#gwcs").show();

            }

        } else {
            $("#qtwz").hide();
            $("#gwcs").val("");
        }
    }

</script>


<script>
    function mySubmit() {
        console.log("submit")
        beforeSubmit()
        let data = {
            "account": $("#account").val(),
            "password": $("#password").val(),
            "locationCode": szcsbm,
            "locationName": szcsmc,
            "inSchool": $("#inSchool").is(":checked")
        }
        if (!ok) return;
        $.ajax({
            type: "POST",
            url: "/new",
            data: data,
            dataType: "text",
            success: function (resp) {
                alert(resp)
            }
        });
    }

    let szcsbm = "";
    let szcsmc = "";
    let ok = true;

    function beforeSubmit() {
        ok = true;

        let account = $("#account").val();
        if (account == undefined || account == null || account == '') {
            alert("account can't be empty.");
            ok = false;
            return;
        }

        let password = $("#password").val();
        if (password == undefined || password == null || password == '') {
            alert("password can't be empty.");
            ok = false;
            return;
        }

        szcsbm = $("input[name='szcsbm']:checked").val();
        if (szcsbm == undefined || szcsbm == '') {
            alert("请选择您当前所在的位置！");
            ok = false;
            return;
        }
        szcsmc = "在学校";
        if (szcsbm == '2') {
            szcsmc = "在西安";
        } else if (szcsbm == '3') {
            szcsbm = $("#district").val();
            if ($('#district').css('display') == 'none') {
                var city = $("#city").val();
                if (city == "") {
                    alert("请选择当前所在省市！");
                    ok = false;
                    $("#city").focus();
                    return;
                }
                szcsbm = city + "00";
            } else {
                if (szcsbm == "") {
                    alert("请选择当前所在省市区/县！");
                    ok = false;
                    $("#district").focus();
                    return;
                }
            }
            szcsmc = $('#province option').not(function () {
                return !this.selected;
            }).text();
            szcsmc += $('#city option').not(function () {
                return !this.selected;
            }).text();
            if ($('#district').css('display') != 'none') {
                szcsmc += $('#district option').not(function () {
                    return !this.selected;
                }).text();
            }
        }
    }
</script>